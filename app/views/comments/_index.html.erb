<!-- 'videos/show'で使用 -------------------------------------------------------------------------------------------------------------->
<h5>コメント一覧 <%= "(#{@comments.count}件)" %></h5>
<%= render 'layouts/flash' %>
<% @comments.each do |comment| %>
  <hr>
  <div class="content-show-comment-bottom-top">
    <div class="content-show-comment-bottom-top-user">
      <!-- アカウントのアイコンを表示 -->
      <div class="content-show-comment-bottom-top-user-icon">
        <% if comment.user.present? && comment.user.image.present? %>
          <%= image_tag comment.user.image.url, fallback: "default.png", class:"comment-image", size: "40x40" %>
        <% elsif comment.viewer.present? && comment.viewer.image.present? %> 
          <%= image_tag comment.viewer.image.url, fallback: "default.png", class:"comment-image",size: "40x40" %>
        <% else %>
          <%= image_tag "default.png", class:"comment-image", size: "40x40" %>
        <% end %>
      </div> 
      <!-- アカウントの名前を表示 -->
      <div class="content-show-comment-bottom-top-user-name">
        <% if comment.user.present? && comment.user.name.present? %>
          <%= comment.user.name %>さん
        <% elsif comment.viewer.present? && comment.viewer.name.present? %>
          <%= comment.viewer.name %>さん
        <% else %>
          ゲストさん
        <% end %>
      <!-- コメントを表示 -->
      <div class="comment-entry">
        <%= simple_format(comment.comment) %>
        <%= comment.created_at.strftime('%Y/%m/%d') %>
      </div>
      <!-- 返信ボタン、削除ボタンを表示 -->
      <div class="content-show-comment-bottom-top-icons">
      <!-- ログイン済みかつコメントしたアカウント本人であれば削除ボタンを表示 -->
        <% if is_login? && (comment.user_id == @account.id || comment.viewer_id == @account.id) %>
          <div class="content-show-comment-bottom-top-icons-delete">
            <%= link_to video_comment_path(comment.video_id, comment.id), method: :delete, remote: true, data: { confirm: "削除しますか？" } do %>
              <i class="far fa-trash-alt" color=red></i>
            <% end %>
          </div>
        <% end %>              
      </div>
    </div>
  </div>
  <hr>
  <!-- 返信 ---------------------------------------------------------------------------------------------------------------------->
  <% if is_login? %>
    <div class="content-show-comment-bottom-reply">
      <%= render partial: 'replies/form', locals: { comment: comment } %>
    </div>
  <% end %>

  <!-- 返信の件数を表示 -->
  <div class="content-show-comment-bottom-view-btn">
    <% if comment.replies.present? %>
      <%= "#{ comment.replies.count } 件の返信" %>
    <% else %>
      <p>コメントの返信はありません</p>
    <% end %>
  </div>

  <!-- 返信部分 -->
  <% if comment.replies.present? %>
    <% comment.replies.each do |reply| %>
      <div class="content-show-comment-bottom-view-reply">
        <div class="content-show-comment-bottom-view-reply-top">
          <div class="content-show-comment-bottom-view-reply-top-user">
            <!-- アカウントのアイコンを表示 -->
            <div class="content-show-comment-bottom-view-reply-top-user-icon">
              <% if reply.user.present? && reply.user.image.present? %>
                <%= image_tag reply.user.image.url, fallback: "default.png", size: "40x40" %>
              <% elsif reply.viewer.present? && reply.viewer.iamge.present? %>
                <%= image_tag reply.vewer.image.url, fallback: "default.png", class:"comment-image", size: "40x40" %>
              <% else %>
                <%= image_tag "default.png", class:"comment-image", size: "40x40" %>
              <% end %>
            <!-- アカウントの名前を表示 -->
            <div class="content-show-comment-bottom-view-reply-top-user-name">
              <% if reply.user.present? && reply.user.name.present? %>
                <%= reply.user.name %>さん
              <% elsif reply.viewer.present? && reply.viewer.name.present? %> 
                <%= reply.viewer.name %>さん
              <% else %>
                ゲストさん
              <% end %>
            </div>
            <!-- 返信削除ボタンを表示 -->
            <div class="content-show-comment-bottom-view-reply-top-icons">
              <!-- ログイン済みかつ返信したアカウントの場合、削除ボタンを表示 -->
              <% if is_login? && (reply.user_id == @account.id || reply.viewer_id == @account.id) %>
                <div class="content-show-comment-bottom-view-reply-top-icons-delete">
                  <%= link_to video_comment_reply_path(comment.video_id, reply.comment_id, reply.id), method: :delete, remote: true, data: { confirm: "削除しますか？" } do %>
                    <i class="far fa-trash-alt" color=red></i>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>      
        </div> 
        <!-- 返信を表示 -->
        <div class="content-show-comment-bottom-view-reply-text">
          <%= simple_format(reply.reply) %>
          <%= reply.created_at.strftime('%Y/%m/%d') %>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>
